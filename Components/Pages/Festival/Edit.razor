@page "/festivals/edit"
@rendermode InteractiveServer

@inject IFestivalRepository festivalRepository
@inject NavigationManager NavigationManager

<Fields>
	<Field>
		<Label>Name:</Label>
		<TextEdit @bind-Text="Festival.Name" Placeholder="Enter festival name" Required="true" />
	</Field>
	<Field>
		<Label>Location:</Label>
		<TextEdit @bind-Text="Festival.Location" Placeholder="Enter festival location" Required="true" />
	</Field>
	<Field>
		<Label>Start Date:</Label>
		<Addons>
			<Addon AddonType="AddonType.Body">
				<DatePicker @ref="@startDatePicker" @bind-Date="@Festival.StartDate" />
			</Addon>
			<Addon AddonType="AddonType.End">
				<Button Color="Color.Light" Clicked="@(()=>startDatePicker.ToggleAsync())" Class="date-btn">
					<Icon Name="IconName.CalendarDay" /> Alege data
				</Button>
			</Addon>
		</Addons>
	</Field>
	<Field>
		<Label>End Date:</Label>
		<Addons>
			<Addon AddonType="AddonType.Body">
				<DatePicker @ref="@endDatePicker" @bind-Date="@Festival.EndDate" />
			</Addon>
			<Addon AddonType="AddonType.End">
				<Button Color="Color.Light" Clicked="@(()=>endDatePicker.ToggleAsync())" Class="date-btn">
					<Icon Name="IconName.CalendarDay" /> Alege data
				</Button>
			</Addon>
		</Addons>
	</Field>
</Fields>

<Button Color="Color.Primary" Type="ButtonType.Button" Clicked="HandleSubmit">Save</Button>
<Button Color="Color.Secondary" Type="ButtonType.Button" Clicked="Cancel">Cancel</Button>

<div>
	<a href="/festivals">Back to list</a>
</div>

@code {
	private Festival? Festival { get; set; } = new();

	[SupplyParameterFromQuery]
	public Guid Id { get; set; }

	DatePicker<DateTime?> startDatePicker;
	DatePicker<DateTime?> endDatePicker;

	DateTime? value;

	protected override async Task OnInitializedAsync()
	{
		Festival = await festivalRepository.GetByIdAsync(Id);
	}

	private async Task HandleSubmit()
	{
		festivalRepository.Update(Festival);
		await festivalRepository.SaveChangesAsync();
		NavigationManager.NavigateTo("/festivals");
	}

	private void Cancel()
	{
		NavigationManager.NavigateTo("/festivals");
	}
}
